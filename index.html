<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Read Tabular Data With Interlaced Values And Missing Reasons • interlacer</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Read Tabular Data With Interlaced Values And Missing Reasons">
<meta name="description" content="Textual tabular data sources often encode values and missing reasons into the same texkual column. This packages loads such data and deinterlaces the tabular source into a dataframe with two columns per variable: one for values, and one for missing reasons. This representation provides a tidy and typesafe interface for working with values and missing reasons in R.">
<meta property="og:description" content="Textual tabular data sources often encode values and missing reasons into the same texkual column. This packages loads such data and deinterlaces the tabular source into a dataframe with two columns per variable: one for values, and one for missing reasons. This representation provides a tidy and typesafe interface for working with values and missing reasons in R.">
<meta property="og:image" content="http://kylehusmann.com/interlacer/logo.png">
<script data-goatcounter="https://interlacer.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">interlacer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="articles/interlacer.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/extended-column-types.html">Extended Column Types</a></li>
    <li><a class="dropdown-item" href="articles/coded-data.html">Coded Data</a></li>
    <li><a class="dropdown-item" href="articles/other-approaches.html">Other Approaches</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/khusmann/interlacer/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="interlacer-">interlacer <a class="anchor" aria-label="anchor" href="#interlacer-"></a>
</h1>
</div>
<p><a href="https://www.repostatus.org/#wip" class="external-link"><img src="https://www.repostatus.org/badges/latest/wip.svg" alt="Project Status: WIP – Initial development is in progress, but there has not yet been a stable, usable release suitable for the public."></a> <a href="https://github.com/khusmann/interlacer/actions/workflows/check-standard.yaml" class="external-link"><img src="https://github.com/khusmann/interlacer/actions/workflows/check-standard.yaml/badge.svg" alt="R-CMD-check"></a> <a href="https://codecov.io/gh/khusmann/interlacer" class="external-link"><img src="https://codecov.io/gh/khusmann/interlacer/graph/badge.svg?token=R4WNWH5NXU" alt="codecov"></a></p>
<p>When a value is missing in your data, sometimes you want to know <em>why</em> it is missing. Many textual tabular data sources will encode missing reasons as special values <em>interlaced</em> with the regular values in a column (e.g. <code>N/A</code>, <code>REFUSED</code>, <code>-99</code>, etc.). Unfortunately, the missing reasons are lost when these values are all converted into a single <code>NA</code> type. Working with missing reasons in R traditionally requires loading variables as character vectors and doing a bunch of string comparisons and type conversions to make sense of them.</p>
<p>interlacer provides functions that load variables from interlaced data sources into a special <code>interlaced</code> column type that holds values and <code>NA</code> reasons in separate <em>channels</em> of the same variable. In most contexts, you can treat <code>interlaced</code> columns as if they were regular values: if you take the <code>mean</code> of an interlaced column, for example, you get the mean of its values, without its missing reasons interfering in the computation.</p>
<p>Unlike a regular column, however, the missing reasons are still available. This means you can still filter data frames on variables by specific missing reasons, or generate summary statistics with breakdowns by missing reason. In other words, you no longer have to constantly manually include / exclude missing reasons in computations by filtering them with awkward string comparisons or type conversions… everything just works!</p>
<p>In addition to the introduction in <code><a href="articles/interlacer.html">vignette("interlacer")</a></code> be sure to also check out:</p>
<ul>
<li><p><code><a href="articles/extended-column-types.html">vignette("extended-column-types")</a></code> to see how to handle variable-level missing reasons</p></li>
<li><p><code><a href="articles/coded-data.html">vignette("coded-data")</a></code> for some recipies for working with coded data (e.g. data produced by SPSS, SAS or Stata)</p></li>
<li><p><code><a href="articles/other-approaches.html">vignette("other-approaches")</a></code> for a deep dive into how interlacer’s approach compares to other approaches for representing and manipulating missing reasons alongside data values</p></li>
</ul>
<div class="section level3">
<h3 id="id_️-️-️-warning-️-️-️">⚠️ ⚠️ ⚠️ WARNING ⚠️ ⚠️ ⚠️<a class="anchor" aria-label="anchor" href="#id_%EF%B8%8F-%EF%B8%8F-%EF%B8%8F-warning-%EF%B8%8F-%EF%B8%8F-%EF%B8%8F"></a>
</h3>
<p>This library is currently in its experimental stages, so be aware that its interface is quite likely to change in the future. In the meantime, please try it out and <a href="mailto:kdh38@psu.edu">let me know what you think</a>!</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>The easiest way to get interlacer is to install via devtools:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span> <span class="co"># If devtools is not already installed</span></span>
<span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"khusmann/interlacer"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>To use interlacer, load it into your current R session:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/khusmann/interlacer" class="external-link">interlacer</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>interlacer supports the following file formats with these <code>read_interlaced_*()</code> functions, which extend the <code>readr::read_*()</code> family of functions:</p>
<ul>
<li><code><a href="reference/read_interlaced_delim.html">read_interlaced_csv()</a></code></li>
<li><code><a href="reference/read_interlaced_delim.html">read_interlaced_tsv()</a></code></li>
<li><code><a href="reference/read_interlaced_delim.html">read_interlaced_csv2()</a></code></li>
<li><code><a href="reference/read_interlaced_delim.html">read_interlaced_delim()</a></code></li>
</ul>
<p>As a quick demo, consider the following example file bundled with interlacer:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_file.html" class="external-link">read_file</a></span><span class="op">(</span><span class="fu"><a href="reference/interlacer_example.html">interlacer_example</a></span><span class="op">(</span><span class="st">"colors.csv"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; person_id,age,favorite_color</span></span>
<span><span class="co">#&gt; 1,20,BLUE</span></span>
<span><span class="co">#&gt; 2,REFUSED,BLUE</span></span>
<span><span class="co">#&gt; 3,21,REFUSED</span></span>
<span><span class="co">#&gt; 4,30,OMITTED</span></span>
<span><span class="co">#&gt; 5,1,N/A</span></span>
<span><span class="co">#&gt; 6,41,RED</span></span>
<span><span class="co">#&gt; 7,50,OMITTED</span></span>
<span><span class="co">#&gt; 8,30,YELLOW</span></span>
<span><span class="co">#&gt; 9,REFUSED,REFUSED</span></span>
<span><span class="co">#&gt; 10,OMITTED,RED</span></span>
<span><span class="co">#&gt; 11,10,REFUSED</span></span></code></pre></div>
<p>In this csv file, values are interlaced with three possible missing reasons: <code>REFUSED</code>, <code>OMITTED</code>, and <code>N/A</code>.</p>
<p>With <code>readr</code>, loading these data would result in a data frame where all missing reasons are replaced with <code>NA</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="reference/interlacer_example.html">interlacer_example</a></span><span class="op">(</span><span class="st">"colors.csv"</span><span class="op">)</span>,</span>
<span>  na <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"REFUSED"</span>, <span class="st">"OMITTED"</span>, <span class="st">"N/A"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 11 × 3</span></span>
<span><span class="co">#&gt;    person_id   age favorite_color</span></span>
<span><span class="co">#&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;         </span></span>
<span><span class="co">#&gt;  1         1    20 BLUE          </span></span>
<span><span class="co">#&gt;  2         2    NA BLUE          </span></span>
<span><span class="co">#&gt;  3         3    21 &lt;NA&gt;          </span></span>
<span><span class="co">#&gt;  4         4    30 &lt;NA&gt;          </span></span>
<span><span class="co">#&gt;  5         5     1 &lt;NA&gt;          </span></span>
<span><span class="co">#&gt;  6         6    41 RED           </span></span>
<span><span class="co">#&gt;  7         7    50 &lt;NA&gt;          </span></span>
<span><span class="co">#&gt;  8         8    30 YELLOW        </span></span>
<span><span class="co">#&gt;  9         9    NA &lt;NA&gt;          </span></span>
<span><span class="co">#&gt; 10        10    NA RED           </span></span>
<span><span class="co">#&gt; 11        11    10 &lt;NA&gt;</span></span></code></pre></div>
<p>With interlacer, missing reasons are preserved:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/read_interlaced_delim.html">read_interlaced_csv</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="reference/interlacer_example.html">interlacer_example</a></span><span class="op">(</span><span class="st">"colors.csv"</span><span class="op">)</span>,</span>
<span>  na <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"REFUSED"</span>, <span class="st">"OMITTED"</span>, <span class="st">"N/A"</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 11 × 3</span></span>
<span><span class="co">#&gt;    person_id       age favorite_color</span></span>
<span><span class="co">#&gt;    &lt;dbl,fct&gt; &lt;dbl,fct&gt; &lt;chr,fct&gt;     </span></span>
<span><span class="co">#&gt;  1         1        20 BLUE          </span></span>
<span><span class="co">#&gt;  2         2 &lt;REFUSED&gt; BLUE          </span></span>
<span><span class="co">#&gt;  3         3        21 &lt;REFUSED&gt;     </span></span>
<span><span class="co">#&gt;  4         4        30 &lt;OMITTED&gt;     </span></span>
<span><span class="co">#&gt;  5         5         1 &lt;N/A&gt;         </span></span>
<span><span class="co">#&gt;  6         6        41 RED           </span></span>
<span><span class="co">#&gt;  7         7        50 &lt;OMITTED&gt;     </span></span>
<span><span class="co">#&gt;  8         8        30 YELLOW        </span></span>
<span><span class="co">#&gt;  9         9 &lt;REFUSED&gt; &lt;REFUSED&gt;     </span></span>
<span><span class="co">#&gt; 10        10 &lt;OMITTED&gt; RED           </span></span>
<span><span class="co">#&gt; 11        11        10 &lt;REFUSED&gt;</span></span></code></pre></div>
<p>As you can see, in the printout above each column is defined by <em>two</em> types: a type for values, and a type for missing reasons. The <code>age</code> column, for example, has type <code>double</code> for its values, and type <code>factor</code> for its missing reasons:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex</span><span class="op">$</span><span class="va">age</span></span>
<span><span class="co">#&gt; &lt;interlaced&lt;dbl, fct&gt;[11]&gt;</span></span>
<span><span class="co">#&gt;  [1] 20        &lt;REFUSED&gt; 21        30        1         41        50       </span></span>
<span><span class="co">#&gt;  [8] 30        &lt;REFUSED&gt; &lt;OMITTED&gt; 10       </span></span>
<span><span class="co">#&gt; NA levels: REFUSED OMITTED N/A</span></span></code></pre></div>
<p>Computations automatically operate on values:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ex</span><span class="op">$</span><span class="va">age</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 25.375</span></span></code></pre></div>
<p>But the missing reasons are still there! To indicate a value should be treated as a missing reason instead of a regular value, you can use the <code><a href="reference/na.html">na()</a></code> function. The following, for example, will filter the data set for all individuals that <code>REFUSED</code> to give their favorite color:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">favorite_color</span> <span class="op">==</span> <span class="fu"><a href="reference/na.html">na</a></span><span class="op">(</span><span class="st">"REFUSED"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span><span class="co">#&gt;   person_id       age favorite_color</span></span>
<span><span class="co">#&gt;   &lt;dbl,fct&gt; &lt;dbl,fct&gt; &lt;chr,fct&gt;     </span></span>
<span><span class="co">#&gt; 1         3        21 &lt;REFUSED&gt;     </span></span>
<span><span class="co">#&gt; 2         9 &lt;REFUSED&gt; &lt;REFUSED&gt;     </span></span>
<span><span class="co">#&gt; 3        11        10 &lt;REFUSED&gt;</span></span></code></pre></div>
<p>And here’s a pipeline that will compute a breakdown of the mean age of respondents for each favorite color, with separate categories for each missing reason:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    mean_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">age</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    .by <span class="op">=</span> <span class="va">favorite_color</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">favorite_color</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 3</span></span>
<span><span class="co">#&gt;   favorite_color mean_age     n</span></span>
<span><span class="co">#&gt;   &lt;chr,fct&gt;         &lt;dbl&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 BLUE               20       2</span></span>
<span><span class="co">#&gt; 2 RED                41       2</span></span>
<span><span class="co">#&gt; 3 YELLOW             30       1</span></span>
<span><span class="co">#&gt; 4 &lt;REFUSED&gt;          15.5     3</span></span>
<span><span class="co">#&gt; 5 &lt;OMITTED&gt;          40       2</span></span>
<span><span class="co">#&gt; 6 &lt;N/A&gt;               1       1</span></span></code></pre></div>
<p>But this just scratches the surface of what can be done with interlacer… check out <code><a href="articles/interlacer.html">vignette("interlacer")</a></code> for a more complete overview!</p>
</div>
<div class="section level2">
<h2 id="known-issues">Known Issues<a class="anchor" aria-label="anchor" href="#known-issues"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Some base functions, like <code><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">base::ifelse()</a></code>, drop the missing reason channel on interlaced types, converting them into regular vectors</li>
</ol>
<p>For example:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    favorite_color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&lt;</span> <span class="fl">18</span>, <span class="fu"><a href="reference/na.html">na</a></span><span class="op">(</span><span class="st">"REDACTED"</span><span class="op">)</span>, <span class="va">favorite_color</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 11 × 3</span></span>
<span><span class="co">#&gt;    person_id       age favorite_color</span></span>
<span><span class="co">#&gt;    &lt;dbl,fct&gt; &lt;dbl,fct&gt; &lt;chr&gt;         </span></span>
<span><span class="co">#&gt;  1         1        20 BLUE          </span></span>
<span><span class="co">#&gt;  2         2 &lt;REFUSED&gt; &lt;NA&gt;          </span></span>
<span><span class="co">#&gt;  3         3        21 &lt;NA&gt;          </span></span>
<span><span class="co">#&gt;  4         4        30 &lt;NA&gt;          </span></span>
<span><span class="co">#&gt;  5         5         1 &lt;NA&gt;          </span></span>
<span><span class="co">#&gt;  6         6        41 RED           </span></span>
<span><span class="co">#&gt;  7         7        50 &lt;NA&gt;          </span></span>
<span><span class="co">#&gt;  8         8        30 YELLOW        </span></span>
<span><span class="co">#&gt;  9         9 &lt;REFUSED&gt; &lt;NA&gt;          </span></span>
<span><span class="co">#&gt; 10        10 &lt;OMITTED&gt; &lt;NA&gt;          </span></span>
<span><span class="co">#&gt; 11        11        10 &lt;NA&gt;</span></span></code></pre></div>
<p>This is due to a <a href="https://vctrs.r-lib.org/#motivation" class="external-link">limitation of R</a>. If you run into this, use the tidyverse equivalent of the function. Tidyverse functions are designed to more correctly handle type conversions. In this example, we can use <code><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">dplyr::if_else()</a></code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    favorite_color <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span></span>
<span>      <span class="va">age</span> <span class="op">&lt;</span> <span class="fl">18</span>,</span>
<span>      <span class="fu"><a href="reference/na.html">na</a></span><span class="op">(</span><span class="st">"REDACTED_UNDERAGE"</span><span class="op">)</span>,</span>
<span>      <span class="va">favorite_color</span>,</span>
<span>      missing <span class="op">=</span> <span class="fu"><a href="reference/na.html">na</a></span><span class="op">(</span><span class="st">"REDACTED_MISSING_AGE"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 11 × 3</span></span>
<span><span class="co">#&gt;    person_id       age favorite_color        </span></span>
<span><span class="co">#&gt;    &lt;dbl,fct&gt; &lt;dbl,fct&gt; &lt;chr,fct&gt;             </span></span>
<span><span class="co">#&gt;  1         1        20 BLUE                  </span></span>
<span><span class="co">#&gt;  2         2 &lt;REFUSED&gt; &lt;REDACTED_MISSING_AGE&gt;</span></span>
<span><span class="co">#&gt;  3         3        21 &lt;REFUSED&gt;             </span></span>
<span><span class="co">#&gt;  4         4        30 &lt;OMITTED&gt;             </span></span>
<span><span class="co">#&gt;  5         5         1 &lt;REDACTED_UNDERAGE&gt;   </span></span>
<span><span class="co">#&gt;  6         6        41 RED                   </span></span>
<span><span class="co">#&gt;  7         7        50 &lt;OMITTED&gt;             </span></span>
<span><span class="co">#&gt;  8         8        30 YELLOW                </span></span>
<span><span class="co">#&gt;  9         9 &lt;REFUSED&gt; &lt;REDACTED_MISSING_AGE&gt;</span></span>
<span><span class="co">#&gt; 10        10 &lt;OMITTED&gt; &lt;REDACTED_MISSING_AGE&gt;</span></span>
<span><span class="co">#&gt; 11        11        10 &lt;REDACTED_UNDERAGE&gt;</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Performance with large data sets</li>
</ol>
<p>You may notice that on large datasets <code>interlacer</code> runs significantly slower than <code>readr</code> / <code>vroom</code>. Although <code>interlacer</code> uses <code>vroom</code> under the hood to load delimited data, it is not able to take advantage of many of its optimizations because <code>vroom</code> <a href="https://github.com/tidyverse/vroom/issues/532" class="external-link">does not currently support</a> column-level missing values. As soon as <code>vroom</code> supports column-level missing values, I will be able to remedy this!</p>
</div>
<div class="section level2">
<h2 id="related-work">Related work<a class="anchor" aria-label="anchor" href="#related-work"></a>
</h2>
<p>interlacer was inspired by the <a href="https://haven.tidyverse.org/" class="external-link"><code>haven</code></a>, <a href="https://larmarange.github.io/labelled/" class="external-link"><code>labelled</code></a>, and <a href="https://dusadrian.github.io/declared/" class="external-link"><code>declared</code></a> packages. These packages provide similar functionality to interlacer, but are more focused on providing compatibility with missing reason data imported from SPSS, SAS, and Stata. interlacer has slightly different aims:</p>
<ol style="list-style-type: decimal">
<li>Be fully generic: Add a missing value channel to <em>any</em> vector type.</li>
<li>Provide functions for reading / writing interlaced CSV files (not just SPSS / SAS / Stata files)</li>
<li>Provide a functional API that integrates well into tidy pipelines</li>
</ol>
<p>Future versions of interlacer will provide functions to convert to and from these other packages’ types.</p>
<p>For a more detailed discussion, see <code><a href="articles/other-approaches.html">vignette("other-approaches")</a></code>.</p>
</div>
<div class="section level2">
<h2 id="acknowledgements">Acknowledgements<a class="anchor" aria-label="anchor" href="#acknowledgements"></a>
</h2>
<p>The development of this software was supported, in whole or in part, by the Institute of Education Sciences, U.S. Department of Education, through Grant R305A170047 to The Pennsylvania State University. The opinions expressed are those of the authors and do not represent the views of the Institute or the U.S. Department of Education.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/khusmann/interlacer/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/khusmann/interlacer/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>Apache License (&gt;= 2)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing interlacer</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Kyle Husmann <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kyle Husmann.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
