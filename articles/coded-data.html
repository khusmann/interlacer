<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="interlacer">
<title>Coded Data • interlacer</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Coded Data">
<meta property="og:description" content="interlacer">
<meta property="og:image" content="http://kylehusmann.com/interlacer/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-Q0KYX25N11"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Q0KYX25N11');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">interlacer</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/interlacer.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/mutations.html">Mutating Values and Missing Reasons</a>
    <a class="dropdown-item" href="../articles/column-types.html">Interlaced Column Types</a>
    <a class="dropdown-item" href="../articles/coded-data.html">Coded Data</a>
    <a class="dropdown-item" href="../articles/other-approaches.html">Other Approaches</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Coded Data</h1>
            
      
      
      <div class="d-none name"><code>coded-data.Rmd</code></div>
    </div>

    
    
<p>In addition to interlacing values and missing reasons, many
statistical software packages will store categorical values and missing
reasons as alphanumeric codes. These codes are often chosen so that
numeric comparisons or casts can be used to determine if a value
represents a real value or missing reason. Like 8-character variable
name limits, this practice comes from a historical need to save digital
storage space even if it made analyses less readable and more
error-prone.</p>
<p>Even though storage is cheap these days, coded formats continue to be
the standard format used by statistical software packages like SPSS,
SAS, and Stata. This article will describe these common coding schemes
and how they can be decoded and deinterlaced to make them easier to work
with in R.</p>
<div class="section level2">
<h2 id="numeric-codes-with-negative-missing-reasons-spss">Numeric codes with negative missing reasons (SPSS)<a class="anchor" aria-label="anchor" href="#numeric-codes-with-negative-missing-reasons-spss"></a>
</h2>
<p>It’s extremely common to find data sources that encode all
categorical responses as numeric values, with negative values
representing missing reason codes. SPSS is one such example. Here’s an
SPSS-formatted version of the <code>colors.csv</code> example:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://kylehusmann.com/interlacer/">interlacer</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_file.html" class="external-link">read_file</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/interlacer_example.html">interlacer_example</a></span><span class="op">(</span><span class="st">"colors_coded.csv"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; person_id,age,favorite_color</span></span>
<span><span class="co">#&gt; 1,20,1</span></span>
<span><span class="co">#&gt; 2,-98,1</span></span>
<span><span class="co">#&gt; 3,21,-98</span></span>
<span><span class="co">#&gt; 4,30,-97</span></span>
<span><span class="co">#&gt; 5,1,-99</span></span>
<span><span class="co">#&gt; 6,41,2</span></span>
<span><span class="co">#&gt; 7,50,-97</span></span>
<span><span class="co">#&gt; 8,30,3</span></span>
<span><span class="co">#&gt; 9,-98,-98</span></span>
<span><span class="co">#&gt; 10,-97,2</span></span>
<span><span class="co">#&gt; 11,10,-98</span></span></code></pre></div>
<p>Where missing reasons are:</p>
<blockquote>
<p>-99: N/A</p>
<p>-98: REFUSED</p>
<p>-97: OMITTED</p>
</blockquote>
<p>And colors are coded:</p>
<blockquote>
<p>1: BLUE</p>
<p>2: RED</p>
<p>3: YELLOW</p>
</blockquote>
<p>This format gives you the ability to load everything as a numeric
type:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">df_coded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/interlacer_example.html">interlacer_example</a></span><span class="op">(</span><span class="st">"colors_coded.csv"</span><span class="op">)</span>,</span>
<span>  col_types <span class="op">=</span> <span class="st">"n"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 11 × 3</span></span></span>
<span><span class="co">#&gt;    person_id   age favorite_color</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>         1    20              1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>         2   -<span style="color: #BB0000;">98</span>              1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>         3    21            -<span style="color: #BB0000;">98</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>         4    30            -<span style="color: #BB0000;">97</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>         5     1            -<span style="color: #BB0000;">99</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>         6    41              2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>         7    50            -<span style="color: #BB0000;">97</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>         8    30              3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>         9   -<span style="color: #BB0000;">98</span>            -<span style="color: #BB0000;">98</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>        10   -<span style="color: #BB0000;">97</span>              2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>        11    10            -<span style="color: #BB0000;">98</span></span></span></code></pre></div>
<p>To test if a value is a missing code, you can check if it’s less than
0:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_coded</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    favorite_color_missing <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">favorite_color</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="va">favorite_color</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="va">age</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    mean_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">age</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    .by <span class="op">=</span> <span class="va">favorite_color_missing</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;   favorite_color_missing mean_age     n</span></span>
<span><span class="co">#&gt;                    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                     <span style="color: #BB0000;">NA</span>     30.3     5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                    -<span style="color: #BB0000;">98</span>     15.5     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>                    -<span style="color: #BB0000;">97</span>     40       2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>                    -<span style="color: #BB0000;">99</span>      1       1</span></span></code></pre></div>
<p>The downsides of this approach are twofold: 1) all of your values and
missing reasons become codes you have to remember and 2) it’s really
easy to make mistakes.</p>
<p>What sort of mistakes? Well, because everything is numeric, there’s
nothing stopping us from treating missing reason codes as if they are
regular values… If you forget to remove your missing reason codes, R
will still happily compute aggregations using the negative numbers!</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_coded</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    favorite_color_missing <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">favorite_color</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="va">favorite_color</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span><span class="co">#    age = if_else(age &gt; 0, age, NA)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    mean_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">age</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    .by <span class="op">=</span> <span class="va">favorite_color_missing</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;   favorite_color_missing mean_age     n</span></span>
<span><span class="co">#&gt;                    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>                     <span style="color: #BB0000;">NA</span>    -<span style="color: #BB0000;">20.8</span>     5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>                    -<span style="color: #BB0000;">98</span>    -<span style="color: #BB0000;">22.3</span>     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>                    -<span style="color: #BB0000;">97</span>     40       2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>                    -<span style="color: #BB0000;">99</span>      1       1</span></span></code></pre></div>
<p>In fact, ANY math you do without filtering for missing codes
potentially ruins the integrity of your data:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This will add 1 to the age values, but ALSO add one to all of the missing</span></span>
<span><span class="co"># reason codes, resulting in corrupted data!</span></span>
<span><span class="va">df_coded</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    age_next_year <span class="op">=</span> <span class="va">age</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>    .after <span class="op">=</span> <span class="va">person_id</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 11 × 4</span></span></span>
<span><span class="co">#&gt;    person_id age_next_year   age favorite_color</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>         1            21    20              1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>         2           -<span style="color: #BB0000;">97</span>   -<span style="color: #BB0000;">98</span>              1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>         3            22    21            -<span style="color: #BB0000;">98</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>         4            31    30            -<span style="color: #BB0000;">97</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>         5             2     1            -<span style="color: #BB0000;">99</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>         6            42    41              2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>         7            51    50            -<span style="color: #BB0000;">97</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>         8            31    30              3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>         9           -<span style="color: #BB0000;">97</span>   -<span style="color: #BB0000;">98</span>            -<span style="color: #BB0000;">98</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>        10           -<span style="color: #BB0000;">96</span>   -<span style="color: #BB0000;">97</span>              2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>        11            11    10            -<span style="color: #BB0000;">98</span></span></span>
<span></span>
<span><span class="co"># This will give you your intended result, but it's easy to forget</span></span>
<span><span class="va">df_coded</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    age_next_year <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="va">age</span>, <span class="va">age</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    .after <span class="op">=</span> <span class="va">person_id</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 11 × 4</span></span></span>
<span><span class="co">#&gt;    person_id age_next_year   age favorite_color</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>         1            21    20              1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>         2           -<span style="color: #BB0000;">98</span>   -<span style="color: #BB0000;">98</span>              1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>         3            22    21            -<span style="color: #BB0000;">98</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>         4            31    30            -<span style="color: #BB0000;">97</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>         5             2     1            -<span style="color: #BB0000;">99</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>         6            42    41              2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>         7            51    50            -<span style="color: #BB0000;">97</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>         8            31    30              3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>         9           -<span style="color: #BB0000;">98</span>   -<span style="color: #BB0000;">98</span>            -<span style="color: #BB0000;">98</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>        10           -<span style="color: #BB0000;">97</span>   -<span style="color: #BB0000;">97</span>              2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>        11            11    10            -<span style="color: #BB0000;">98</span></span></span></code></pre></div>
<p>Have you ever thought you had a significant result, only to find that
it’s only because there are some stray missing reason codes still
interlaced with your values? It’s a bad time.</p>
<p>You’re much better off loading these formats with interlacer, then
converting the codes into labelled factor levels:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org/" class="external-link">forcats</a></span><span class="op">)</span></span>
<span></span>
<span><span class="op">(</span><span class="va">df_decoded_deinterlaced</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_interlaced_delim.html">read_interlaced_csv</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/interlacer_example.html">interlacer_example</a></span><span class="op">(</span><span class="st">"colors_coded.csv"</span><span class="op">)</span>,</span>
<span>  na <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-99"</span>, <span class="st">"-98"</span>, <span class="st">"-97"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/missing_cols.html">missing_cols</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html" class="external-link">fct_recode</a></span><span class="op">(</span><span class="va">x</span>,</span>
<span>        `N/A` <span class="op">=</span> <span class="st">"-99"</span>,</span>
<span>        REFUSED <span class="op">=</span> <span class="st">"-98"</span>,</span>
<span>        OMITTED <span class="op">=</span> <span class="st">"-97"</span>,</span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    favorite_color <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html" class="external-link">fct_recode</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">favorite_color</span><span class="op">)</span>,</span>
<span>      BLUE <span class="op">=</span> <span class="st">"1"</span>,</span>
<span>      RED <span class="op">=</span> <span class="st">"2"</span>,</span>
<span>      YELLOW <span class="op">=</span> <span class="st">"3"</span>,</span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A deinterlaced tibble: 11 × 6</span></span></span>
<span><span class="co">#&gt;    person_id .person_id.   age .age.   favorite_color .favorite_color.</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>         1 <span style="color: #BB0000;">NA</span>             20 <span style="color: #BB0000;">NA</span>      BLUE           <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>         2 <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span> REFUSED BLUE           <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>         3 <span style="color: #BB0000;">NA</span>             21 <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>             REFUSED         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>         4 <span style="color: #BB0000;">NA</span>             30 <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>             OMITTED         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>         5 <span style="color: #BB0000;">NA</span>              1 <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>             N/A             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>         6 <span style="color: #BB0000;">NA</span>             41 <span style="color: #BB0000;">NA</span>      RED            <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>         7 <span style="color: #BB0000;">NA</span>             50 <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>             OMITTED         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>         8 <span style="color: #BB0000;">NA</span>             30 <span style="color: #BB0000;">NA</span>      YELLOW         <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>         9 <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span> REFUSED <span style="color: #BB0000;">NA</span>             REFUSED         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>        10 <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span> OMITTED RED            <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>        11 <span style="color: #BB0000;">NA</span>             10 <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>             REFUSED</span></span></code></pre></div>
<p>Now aggregations won’t mix up values and missing codes, and you won’t
have to keep cross-referencing your codebook to know what values
mean:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_decoded_deinterlaced</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    mean_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">age</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    .by <span class="op">=</span> <span class="va">.favorite_color.</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;   .favorite_color. mean_age     n</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> <span style="color: #BB0000;">NA</span>                   30.3     5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> REFUSED              15.5     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> OMITTED              40       2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> N/A                   1       1</span></span></code></pre></div>
<p>Other operations work with similar ease:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_decoded_deinterlaced</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    age_next_year <span class="op">=</span> <span class="va">age</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>    .after <span class="op">=</span> <span class="va">person_id</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/coalesce_channels.html">coalesce_channels</a></span><span class="op">(</span>missing_reason <span class="op">=</span> <span class="st">"AGE_UNAVAILABLE"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A deinterlaced tibble: 11 × 8</span></span></span>
<span><span class="co">#&gt;    person_id .person_id. age_next_year .age_next_year.   age .age.  </span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>         1 <span style="color: #BB0000;">NA</span>                     21 <span style="color: #BB0000;">NA</span>                 20 <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>         2 <span style="color: #BB0000;">NA</span>                     <span style="color: #BB0000;">NA</span> AGE_UNAVAILABLE    <span style="color: #BB0000;">NA</span> REFUSED</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>         3 <span style="color: #BB0000;">NA</span>                     22 <span style="color: #BB0000;">NA</span>                 21 <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>         4 <span style="color: #BB0000;">NA</span>                     31 <span style="color: #BB0000;">NA</span>                 30 <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>         5 <span style="color: #BB0000;">NA</span>                      2 <span style="color: #BB0000;">NA</span>                  1 <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>         6 <span style="color: #BB0000;">NA</span>                     42 <span style="color: #BB0000;">NA</span>                 41 <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>         7 <span style="color: #BB0000;">NA</span>                     51 <span style="color: #BB0000;">NA</span>                 50 <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>         8 <span style="color: #BB0000;">NA</span>                     31 <span style="color: #BB0000;">NA</span>                 30 <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>         9 <span style="color: #BB0000;">NA</span>                     <span style="color: #BB0000;">NA</span> AGE_UNAVAILABLE    <span style="color: #BB0000;">NA</span> REFUSED</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>        10 <span style="color: #BB0000;">NA</span>                     <span style="color: #BB0000;">NA</span> AGE_UNAVAILABLE    <span style="color: #BB0000;">NA</span> OMITTED</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>        11 <span style="color: #BB0000;">NA</span>                     11 <span style="color: #BB0000;">NA</span>                 10 <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: favorite_color &lt;fct&gt;, .favorite_color. &lt;fct&gt;</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="numeric-codes-with-character-missing-reasons-sas-stata">Numeric codes with character missing reasons (SAS, Stata)<a class="anchor" aria-label="anchor" href="#numeric-codes-with-character-missing-reasons-sas-stata"></a>
</h2>
<p>Like SPSS, SAS and Stata will encode factor levels as numeric values,
but instead of representing missing reasons as negative codes, they are
given character codes:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_file.html" class="external-link">read_file</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/interlacer_example.html">interlacer_example</a></span><span class="op">(</span><span class="st">"colors_coded_char.csv"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; person_id,age,favorite_color</span></span>
<span><span class="co">#&gt; 1,20,1</span></span>
<span><span class="co">#&gt; 2,.a,1</span></span>
<span><span class="co">#&gt; 3,21,.a</span></span>
<span><span class="co">#&gt; 4,30,.b</span></span>
<span><span class="co">#&gt; 5,1,.</span></span>
<span><span class="co">#&gt; 6,41,2</span></span>
<span><span class="co">#&gt; 7,50,.b</span></span>
<span><span class="co">#&gt; 8,30,3</span></span>
<span><span class="co">#&gt; 9,.a,.a</span></span>
<span><span class="co">#&gt; 10,.b,2</span></span>
<span><span class="co">#&gt; 11,10,.a</span></span></code></pre></div>
<p>Here, the same value codes are used as the previous example, except
the missing reasons are coded as follows:</p>
<blockquote>
<p>“.”: N/A</p>
<p>“.a”: REFUSED</p>
<p>“.b”: OMITTED</p>
</blockquote>
<p>To handle these missing reasons without interlacer, columns must be
loaded as character vectors:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">df_coded_char</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/interlacer_example.html">interlacer_example</a></span><span class="op">(</span><span class="st">"colors_coded_char.csv"</span><span class="op">)</span>,</span>
<span>  col_types <span class="op">=</span> <span class="st">"c"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 11 × 3</span></span></span>
<span><span class="co">#&gt;    person_id age   favorite_color</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1         20    1             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2         .a    1             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 3         21    .a            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 4         30    .b            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 5         1     .             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 6         41    2             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 7         50    .b            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 8         30    3             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 9         .a    .a            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 10        .b    2             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 11        10    .a</span></span></code></pre></div>
<p>To test if a value is missing, they can be cast to numeric types. If
the cast fails, you know it’s a missing code. If it is successful, you
know it’s a coded value.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_coded_char</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    favorite_color_missing <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">favorite_color</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="va">favorite_color</span>,</span>
<span>      <span class="cn">NA</span></span>
<span>    <span class="op">)</span>,</span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    mean_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">age</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span>,</span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    .by <span class="op">=</span> <span class="va">favorite_color_missing</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Warning: There were 3 warnings in `mutate()`.</span></span>
<span><span class="co">#&gt; The first warning was:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> In argument: `favorite_color_missing =</span></span>
<span><span class="co">#&gt;   if_else(is.na(as.numeric(favorite_color)), favorite_color, NA)`.</span></span>
<span><span class="co">#&gt; Caused by warning in `is_logical()`:</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> NAs introduced by coercion</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Run `dplyr::last_dplyr_warnings()` to see the 2 remaining warnings.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;   favorite_color_missing mean_age     n</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> <span style="color: #BB0000;">NA</span>                         30.3     5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> .a                         15.5     3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> .b                         40       2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> .                           1       1</span></span></code></pre></div>
<p>Although the character missing codes help prevent us from mistakenly
including missing codes in value aggregations, having to cast our
columns to numeric all the time to check for missingness is hardly
ergonomic, and generates annoying warnings. Like before, it’s easier to
import with interlacer and decode the values and missing reasons:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/read_interlaced_delim.html">read_interlaced_csv</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/interlacer_example.html">interlacer_example</a></span><span class="op">(</span><span class="st">"colors_coded_char.csv"</span><span class="op">)</span>,</span>
<span>  na <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"."</span>, <span class="st">".a"</span>, <span class="st">".b"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/missing_cols.html">missing_cols</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html" class="external-link">fct_recode</a></span><span class="op">(</span><span class="va">x</span>,</span>
<span>        `N/A` <span class="op">=</span> <span class="st">"."</span>,</span>
<span>        REFUSED <span class="op">=</span> <span class="st">".a"</span>,</span>
<span>        OMITTED <span class="op">=</span> <span class="st">".b"</span>,</span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    favorite_color <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html" class="external-link">fct_recode</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">favorite_color</span><span class="op">)</span>,</span>
<span>      BLUE <span class="op">=</span> <span class="st">"1"</span>,</span>
<span>      RED <span class="op">=</span> <span class="st">"2"</span>,</span>
<span>      YELLOW <span class="op">=</span> <span class="st">"3"</span>,</span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A deinterlaced tibble: 11 × 6</span></span></span>
<span><span class="co">#&gt;    person_id .person_id.   age .age.   favorite_color .favorite_color.</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>         1 <span style="color: #BB0000;">NA</span>             20 <span style="color: #BB0000;">NA</span>      BLUE           <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>         2 <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span> REFUSED BLUE           <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>         3 <span style="color: #BB0000;">NA</span>             21 <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>             REFUSED         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>         4 <span style="color: #BB0000;">NA</span>             30 <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>             OMITTED         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>         5 <span style="color: #BB0000;">NA</span>              1 <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>             N/A             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>         6 <span style="color: #BB0000;">NA</span>             41 <span style="color: #BB0000;">NA</span>      RED            <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>         7 <span style="color: #BB0000;">NA</span>             50 <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>             OMITTED         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>         8 <span style="color: #BB0000;">NA</span>             30 <span style="color: #BB0000;">NA</span>      YELLOW         <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>         9 <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span> REFUSED <span style="color: #BB0000;">NA</span>             REFUSED         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>        10 <span style="color: #BB0000;">NA</span>             <span style="color: #BB0000;">NA</span> OMITTED RED            <span style="color: #BB0000;">NA</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>        11 <span style="color: #BB0000;">NA</span>             10 <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>             REFUSED</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="encoding-a-decoded-deinterlaced-data-frame-">Encoding a decoded &amp; deinterlaced data frame.<a class="anchor" aria-label="anchor" href="#encoding-a-decoded-deinterlaced-data-frame-"></a>
</h2>
<p>Re-coding and re-interlacing a data frame is easily done as
follows:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_decoded_deinterlaced</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="../reference/missing_cols.html">missing_cols</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html" class="external-link">fct_recode</a></span><span class="op">(</span><span class="va">x</span>,</span>
<span>        `-99` <span class="op">=</span> <span class="st">"N/A"</span>,</span>
<span>        `-98` <span class="op">=</span> <span class="st">"REFUSED"</span>,</span>
<span>        `-97` <span class="op">=</span> <span class="st">"OMITTED"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    favorite_color <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_recode.html" class="external-link">fct_recode</a></span><span class="op">(</span></span>
<span>      <span class="va">favorite_color</span>,</span>
<span>      `1` <span class="op">=</span> <span class="st">"BLUE"</span>,</span>
<span>      `2` <span class="op">=</span> <span class="st">"RED"</span>,</span>
<span>      `3` <span class="op">=</span> <span class="st">"YELLOW"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/write_interlaced_delim.html">write_interlaced_csv</a></span><span class="op">(</span><span class="st">"output.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="haven">haven<a class="anchor" aria-label="anchor" href="#haven"></a>
</h2>
<p>The <a href="https://haven.tidyverse.org/" class="external-link">haven</a> package has
functions for loading native SPSS, SAS, and Stata native file formats
into special data frames that use column attributes and special values
to keep track of interlaces values and missing reasons. For a complete
discussion of how this compares to interlacer’s approach, see
<code><a href="../articles/other-approaches.html">vignette("other-approaches")</a></code>.</p>
<p>Future versions of interlacer could have the ability to convert haven
data frames to and from deinterlaced data frames, but I want to gauge
interest for this feature before I invest the time to implement it. If
this is a a feature you’d use, <a href="mailto:kdh38@psu.edu">please let
me know</a>!</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Kyle Husmann.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
